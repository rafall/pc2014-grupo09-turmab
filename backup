% Exemplo de relatório técnico do IC

% Criado por P.J.de Rezende antes do Alvorecer da História.
% Modificado em 97-06-15 e 01-02-26 por J.Stolfi.
% modificado em 2003-06-07 21:12:18 por stolfi
% modificado em 2008-10-01 por cll
% \def\lastedit{2010-03-16 17:56:58 by stolfi}

\nonstopmode % PARA RODAR LATEX EM BATCH MODE
\documentclass[11pt,twoside]{article}

%INSERTED BY ME
%used to comment mutiple lines within a document
\usepackage{verbatim}
\usepackage[toc,page]{appendix}
\usepackage{float}
\usepackage{indentfirst} %indent all the paragrafers
\usepackage[pdftex]{hyperref}
\usepackage{listings}
\usepackage{color}
\usepackage[lined, boxed, commentsnumbered, linesnumbered]{algorithm2e}
\renewcommand*{\lstlistingname}{C\'{o}digo}
\renewcommand{\lstlistlistingname}{Lista de C\'{o}digos}
\def\lstlistingautorefname{SQL Code}
\lstset{escapeinside=||}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{ %
  language=C,                % the language of the code
  basicstyle=\footnotesize,           % the size of the fonts that are used for the code
  numbers=left,                   % where to put the line-numbers
  numberstyle=\tiny\color{gray},  % the style that is used for the line-numbers
  stepnumber=2,                   % the step between two line-numbers. If it's 1, each line 
                                  % will be numbered
  numbersep=5pt,                  % how far the line-numbers are from the code
  backgroundcolor=\color{white},      % choose the background color. You must add \usepackage{color}
  showspaces=false,               % show spaces adding particular underscores
  showstringspaces=false,         % underline spaces within strings
  showtabs=false,                 % show tabs within strings adding particular underscores
  frame=single,                   % adds a frame around the code
  rulecolor=\color{black},        % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. commens (green here))
  tabsize=2,                      % sets default tabsize to 2 spaces
  captionpos=b,                   % sets the caption-position to bottom
  breaklines=true,                % sets automatic line breaking
  breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
  title=\lstname,                   % show the filename of files included with \lstinputlisting;
                                  % also try caption instead of title
  keywordstyle=\color{blue},          % keyword style
  commentstyle=\color{dkgreen},       % comment style
  stringstyle=\color{mauve},         % string literal style
}

\begin{comment}

    %--------------------------------SECTION{COMMENT}----------------------------------------
    
    \section{}
    
    %--------------------------------END{COMMENT}--------------------------------------------


    %--------------------------------SUBSECTION{COMMENT}-------------------------------------
        
        \subsection{}

    %--------------------------------END{COMMENT}--------------------------------------------

    %--------------------------------SUBSUBSECTION{COMMENT}----------------------------------
    
            \subsubsection{}
            
    %--------------------------------END{COMMENT}--------------------------------------------

% Inserting Image

    \begin{figure}[H]
        \centering
    	\includegraphics[width=11cm,height=8cm]{}
		\caption{}
		\label{}
	\end{figure}

% Inserting Code----------------------------

\usepackage{listings}
\usepackage{color}
\lstset{escapeinside=||}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{ %
  language=C,                % the language of the code
  basicstyle=\footnotesize,           % the size of the fonts that are used for the code
  numbers=left,                   % where to put the line-numbers
  numberstyle=\tiny\color{gray},  % the style that is used for the line-numbers
  stepnumber=2,                   % the step between two line-numbers. If it's 1, each line 
                                  % will be numbered
  numbersep=5pt,                  % how far the line-numbers are from the code
  backgroundcolor=\color{white},      % choose the background color. You must add \usepackage{color}
  showspaces=false,               % show spaces adding particular underscores
  showstringspaces=false,         % underline spaces within strings
  showtabs=false,                 % show tabs within strings adding particular underscores
  frame=single,                   % adds a frame around the code
  rulecolor=\color{black},        % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. commens (green here))
  tabsize=2,                      % sets default tabsize to 2 spaces
  captionpos=b,                   % sets the caption-position to bottom
  breaklines=true,                % sets automatic line breaking
  breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
  title=\lstname,                   % show the filename of files included with \lstinputlisting;
                                  % also try caption instead of title
  keywordstyle=\color{blue},          % keyword style
  commentstyle=\color{dkgreen},       % comment style
  stringstyle=\color{mauve},         % string literal style
}

% Enumerate with roman
\renewcommand{\theenumi}{\roman{enumi}}
\begin{enumerate}

\end{comment}
%INSERTED BY ME



\usepackage{techrep-ic}

%%% SE USAR INGLÊS, TROQUE AS ATIVAÇÕES DOS DOIS COMANDOS A SEGUIR:
\usepackage[brazil]{babel}
%% \usepackage[english]{babel}

%%% SE USAR CODIFICAÇÃO LATIN1 OU UTF-8, ATIVE UM DOS DOIS COMANDOS A
%%% SEGUIR:
%%\usepackage[latin1]{inputenc}
\usepackage[utf8]{inputenc}

%%% Para obter o tamanho de texto recomendado:
\usepackage[margin=1in]{geometry}


\begin{document}

%%% PÁGINA DE CAPA %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% Número do relatório
\TRNumber{001}

% DATA DE PUBLICAÇÃO (PARA A CAPA)
%
\TRYear{14} % Dois dígitos
\TRMonth{5} % Numérico, 01-12

% LISTA DE AUTORES PARA CAPA (sem afiliações).
\TRAuthor{F. N. Candiani \and M. L. Junior \and R. H. F. Minami}

% TÍTULO PARA A CAPA (use \\ para forçar quebras de linha).
\TRTitle{Comparação de \textit{speedup} de\\ programas paralelos e sequenciais utilizando a biblioteca MPI}

\TRMakeCover

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Nomes de autores ABREVIADOS e titulo ABREVIADO,
% para cabeçalhos em cada página.
%
\markboth{Candiani, Junior e Minami}{Speedup paralelo e sequencial}
\pagestyle{myheadings}
\thispagestyle{empty}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TÍTULO e NOMES DOS AUTORES, completos, para a página 1.
% Use "\\" para quebrar linhas, "\and" para separar autores.
%
\title{Comparação de \textit{speedup} de programas paralelos e sequenciais utilizando a biblioteca MPI}

\author{Fernando N. Candiani\thanks{Inst.~de Ciências Matemáticas e Computação, USP. N USP: 7239131 \texttt{fncandiani@usp.br}} \and
Marcius L. Junior\thanks{Inst.~de Ciências Matemáticas e Computação, USP. N USP: 7277433 \texttt{marcius@usp.br}} \and
Rafael H. F. Minami\thanks{Inst.~de Ciências Matemáticas e Computação, USP. N USP: 7573187 \texttt{rafahiroki@usp.br}}}

\date{}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tableofcontents
\listoffigures
\listoftables
\lstlistoflistings

\clearpage

\begin{abstract} 
    adds
\end{abstract}

\section{Introdução}
    Neste relatório nós mostraremos os resultados obtidos e faremos a comparação entre a versão sequencial e a
    paralela de um algoritmo. Todos os códigos e saídas dos programas, bem como os métodos
    de compilação, podem ser encontrados dentro do nosso repositório do 
    {\it Google Code}\footnote{https://code.google.com/p/pc2014-grupo09-turmab/\label{fnt:code}}.

    \subsection{Descrição do problema}
    O prefeito de ICMCTown quer construir um hospital na cidade, que não possui nenhum. Como você é considerado um gênio da computação na cidade, ele te pediu para ajudar a escolher o local perfeito onde o hospital vai ser construído. O hospital deve ser construído de tal forma que a maior distância entre uma casa e o hospital seja a mínima possível.

O sistema de ruas de ICMCTown é representado por n junções (ou esquinas), conectadas por m ruas bidirecionais. Para cada rua, nós conhecemos sua extensão. Nós também sabemos que é possível chegar de uma junção para qualquer outra se movendo pelas ruas.

Sua tarefa é descobrir a localização do hospital, tal que a distância mais curta percorrida pelas ruas da cidade entre o hospital e a junção mais distante seja mínima.

O hospital deve estar localizado em uma junção obrigatoriamente.
        
    \subsection{Exemplo??}

    
        
\section{Algoritmo de menor caminho}
Nesta seção explicaremos e discutiremos dois algoritmos que são utilizados para calcular o menor caminho em um grafo.

    \subsection{Floyd-Warshall}
    O algoritmo de Floyd-Warshall calcula o caminho mais curto entre todos os pares de vértices de um grafo orientado e valorado. Sua complexidade é de $\theta(|V|^3)$.



\begin{algorithm}[H]
\SetKwData{Left}{left}

\KwData{VAR Integer[1..n, 1..n] dist = graph}
\KwData{VAR Integer[1..n, 1..n] dist = pred}
initialization\;
\For{$i \gets 1$ \textbf{to} $n$}{
    \For{$j \gets 1$ \textbf{to} $n$}{
        \If{$dist[i,j] < Infinity$}{
            pred[i,j] = i\;
        }
    }
}
main loop for the algorithm\;
\For{$k \gets 1$ \textbf{to} $n$}{
    \For{$i \gets 1$ \textbf{to} $n$}{
        \For{$j \gets 1$ \textbf{to} $n$}{
            \If{$dist[i, j] > dist[i, k] + dist[k, j]$}{
            dist[i, j] = dist[i, k] + dist[k, j]\;
            pred[i, j] = pred[k, j]\;
            }
        }
    }
}
 \caption{Pseudo código do algoritmo Floyd-Warshall}
\end{algorithm}
    
    \subsection{Dijkstra}
    

complexidade de $\theta(|V|^2)$ onde V é o número de vértices

\begin{algorithm}
\setKwFunction{dijkstra}{dij}
\setKwProg{mDij}{Function}{}{}
\mDij{\dij{Graph, source}}
{
    
}
\end{algorithm}


\section{MPI}
Nesta seção é apresentado uma explicação resumida do que é MPI e como utilizamos em nosso programa.
\subsection{Resumo}

\subsection{Motivação??}

\subsection{Aplicando ao nosso problema}

\section{Resultados}

\subsection{Como rodar o programa}
    
    Nesta seção é apresentado como é feita a compilação e execução e os parâmetros de execução
    e, também, os de entrada do programa.

    \subsubsection{Sequencial}
        Estando dentro do diretório {\it blackscholes/sequencial} onde contem os
        arquivos {\it makefile} e {\it blackscholes.c}, conforme pode ser visto em
        Código \ref{code:blackscholes_seq}, devemos executar os seguintes comandos:\\
        
        {\it usuer@pc-name:dir~\$ make}\\
        O comando {\it make} irá compilar o Código \ref{code:blackscholes_seq} passando
        todos os parâmetros de lincagem das bibliotecas extras.\\
            
        {\it user}@{\it pc-name:dir~}\${\it /usr/bin/time -f }"\%{\it e}" ./{\it blackshcoles}
        $<$ {\it file.in} $>>$ {\it path}/{\it file.out 2}$>$\&{\it 1}\\
        
            O comando irá executar o programa para cálculo de aproximação de valor confiável
            para aplicação de investimentos, recebendo a entra a de {\it file.in}, 
            redirecionando o tempo e as saídas do programa para {\it file.out}.
        
    \subsubsection{Paralelo}
        Estando dentro do diretório {\it blachsholes/paralelo} onde contem os arquivos
        {\it makefile} e {\it blackshcoles.c}, conforme pode ser visto em Código
        \ref{code:blackscholes_par}, devemos executar os seguintes comandos:\\
        
        {\it usuer@pc-name:dir~\$ make}\\
        
        O comando {\it make} irá compilar o Código \ref{code:blackscholes_par} passando
        todos os parâmetros de lincagem das bibliotecas extras.\\
            
        {\it user}@{\it pc-name:dir~}\${\it /usr/bin/time -f }"\%{\it e}" ./{\it blackshcoles} [{\it numeber of threads}] $<$ {\it file.in} $>>$ {\it path}/{\it file.out 2}$>$\&{\it 1}\\
        O comando irá executar o programa para cálculo de aproximação de valor confiável
        para aplicação de investimentos, recebendo como parâmetro o {\it  number of threads}
        e na entrada padrão o arquivo {\it file.in}, redirecionando o tempo e as saídas do
        programa para {\it file.out}.

    \subsection{Dificuldades e Soluções}
    
        

    \subsection{Resultados Obtidos}
    
\subsubsection{Sequencial}

\subsubsection{Paralelo}

\subsubsection{Comparação}

\section{Metodologia de execução dos experimentos}

    Para a execução dos programas feitos, foi criado um {\it script}, mostrado em Código 1, que é capaz de rodar todos os programas definidos (Monte Carlo - sequencial e paralelo, Black-Scholes -sequencial e paralelo) e para cada programa paralelo o {\it script} altera o número de {\it threads} que este vai executar.Esse {\it script} faz a compilação e execução dos programas e após a execução esse redireciona todos os resultados para um arquivo.  Esse arquivo, que foi formatado de forma simples, é utilizado para o cálculo da média e variância, conforme mostrado na Seção 5, dos dados que foram gerados pelos programas, assim podemos analisar melhor os resultados gerado
    \subsection{Dificuldades e Soluções}

    
\section{Cálculo da média e da variância dos dados}
\label{sec:mean_var}

    Como a execução de cada programa foi feita múltiplas vezes, no nosso caso foi executado
    $1000$ vezes, seria inviável calcular a média e o desvio padrão dos dados gerados de forma
    manual. Por isso, foi criado um programa, conforme mostrado em Código \ref{code:mean_var},
    que dado o tamanho de um vetor e o número de variáveis a ser analisado calculará a média
    e variância, levando em consideração que os dados estão distribuídos da seguinte maneira:
    
    \ \\
    \ \indent quantidade dos dados \indent número de variáveis\\
    \ \indent dado 1 da variável a\\
    \ \indent dado 1 da variável b\\
    \ \indent dado 2 da variável a\\
    \ \indent dado 2 da variável b\\
    \ \indent e assim por diante.
    \ \\
    
    Os dados gerados por esse programa serão apresentados dentro das seções respectivas aos
    seus dados.

\section{Como calcular o {\it Speedup }}
\label{sec:speedup}

    Como o próprio termo já diz, o {\it speedup} é o ganho na velocidade quando se compara duas
    situações. No nosso caso usamos o {\it speedup} para calcular o ganho na velocidade de
    execução entre um programa sequencial e um programa paralelo, por isso para saber qual
    a vantagem entre os dois devemos resolver a seguinte razão:
    
    \begin{equation}
        S_p = \frac{T_1}{T_p}
    \end{equation}

    onde $S_p$ é o {\it speedup},
    
    $T_1$ é o tempo médio do algoritmo sequencial e
    
    $T_p$ é o tempo médio do algoritmo paralelo.\\
    
    Espera-se que esse número seja sempre $> 1$ pois isso mostra que o houve um ganho
    no algoritmo paralelo em relação ao sequencial. Para ter um bom {\it speedup}
    o valor $S_p$ esperado deve ser $ > 2$, ou seja, houve uma diminuição de cerca de
    $50\%$ no tempo de execução do programa sequencial em relação ao paralelo.

\section{Hardware utilizado}

    Para todos os programas o mesmo hardware foi utilizado, o do \textit{cluster}. Para obter
    a descrição detalhada do hardware utilizamos o seguinte programa, com um parâmetro:
    
    \ \\ \ \indent {\it phoronix-test-suite detailed-system-info}
    \ \\
    
    A saída obtida foi a seguinte (a grande maioria dos dados são auto-explicativos e por isso
    não será discutido):
    \ \\ \ \\
    {\hspace{2 cm}{\it Phoronix Test Suite v4.8.2\\
         System Information\\
        \ \\
        Hardware: \\
        Processor: Intel Core 2 Quad Q9400 @ 2.67GHz (4 Cores), \\
        Motherboard: Gigabyte G41MT-S2P,\\
        Chipset: Intel 4 DRAM + ICH7,\\
        Memory: 8192MB,\\
        Disk: 500GB Western Digital WD5000AACS-0,\\
        Graphics: Intel 4 IGP,\\
        Audio: VIA VT2020,\\
        Network: Realtek RTL8111/8168/8411
        \ \\
        Software:\\
        OS: Ubuntu 12.04, Kernel: 3.2.0-54-generic (x86\_64), Compiler: GCC 4.6,\\
        File-System: ext4, Screen Resolution: 640x480\\
        \ \\
        Processor: \\
        Core Count: 4\\
        Thread Count: 4\\
        Cache Size: 3072 KB\\
        Instruction Set Extensions: SSE 4.1\\
        AES Encryption: NO\\
        Energy Performance Bias: NO\\
        Virtualization: VT-x\\
        Compiler Configuration: --build=x86\_64-linux-gnu --disable-werror --enable-checking=release --enable-clocale=gnu --enable-gnu-unique-object --enable-languages=c,c++,fortran,objc,obj-c++ --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-nls --enable-objc-gc --enable-plugin --enable six --host=x86\_64-linux-gnu --target=x86\_64-linux-gnu --with-arch-32=i686 --with-tune=generic -v\\
        Disk Scheduler: CFQ\\
        Disk Mount Options: barrier=1,data=ordered,relatime,rw,user\_xattr\\
        Cpu Scaling Governor: acpi-cpufreq ondemand}}

\section{Conclusão}

    
\clearpage

\begin{appendices}

    \chapter{Script para execução dos experimentos}
        \lstinputlisting[caption=Script para execução dos experimentos, language=sh, label=code:script]{codes/script.sh}

    \ \\

    \chapter{Código para cálculo da média e variância dos dados}
        \lstinputlisting[caption=Cálculo da média e variância dos dados., label=code:mean_var]{codes/mean_var.c}
        
    \ \\
        
    \chapter{Código para cálculo de PI, usando método de Monte Carlo, algoritmo sequencial}
        \lstinputlisting[caption=Método de Monte Carlo sequencial., label=code:montecarlo_seq]{codes/montecarlo_seq.c}
        
    \ \\
        
    \chapter{Código para cálculo de PI, usando método de Monte Carlo, algoritmo usando paradigma de paralelismo}
        \lstinputlisting[caption=Método de Monte Carlo paralelo., label=code:montecarlo_par]{codes/montecarlo_par.c}
        
    \ \\
        
    \chapter{Código para cálculo de aproximação de valor confiável para aplicação de investimentos, usando método de Black-Scholes, algoritmo sequencial}
        \lstinputlisting[caption=Método de Black-Scholes sequencial., label=code:blackscholes_seq]{codes/blackscholes_seq.c}
        
    \ \\
        
    \chapter{Código para cálculo de aproximação de valor confiável para aplicação de investimentos, usando método de Black-Scholes, algoritmo usando paradigma de paralelismo}
        \lstinputlisting[caption=Método de Black-Scholes paralelo., label=code:blackscholes_par]{codes/blackscholes_par.c}
        
    \ \\

\end{appendices}

\clearpage

\begin{thebibliography}{99}

    \bibitem{BS} Black, Fischer; Myron Scholes. (1973). {\it The Pricing of Options and Corporate Liabilities}. Journal of Political Economy {\bf 81} (Black and Scholes' original paper.)
    
    \bibitem{M} Merton, Robert C.. (1973). {\it Theory of Rational Option Pricing}. Bell Journal of Economics and Management Science {\bf 4}

\end{thebibliography}

\end{document}
